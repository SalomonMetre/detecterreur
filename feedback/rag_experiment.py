# -*- coding: utf-8 -*-
"""RAG_experiment.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1faCe5mVIyfWkTKm6iNLI3tlIKowa0TzY

# Getting DetectErreur
"""

!pip install git+https://github.com/SalomonMetre/detecterreur

"""## Using FDIA as an example"""

from detecterreur.form.form_diacritic import FormDiacritic

dia = FormDiacritic()
sentence = "Je suis francais"

print(dia.get_error(sentence))

"""# Getting Mistral7b to work for us"""

!pip install -q -U transformers

!pip install -q -U accelerate

!pip install -q -U bitsandbytes

from transformers import AutoTokenizer, AutoModelForCausalLM, BitsAndBytesConfig, pipeline
import torch

bnb_config = BitsAndBytesConfig(
    load_in_4bit=True,
    bnb_4bit_quant_type="nf4",
    bnb_4bit_use_double_quant=True,
)

model_name = "mistralai/Mistral-7B-v0.1"

tokenizer = AutoTokenizer.from_pretrained(model_name)

model = AutoModelForCausalLM.from_pretrained(
        model_name,
        quantization_config=bnb_config,
        dtype=torch.bfloat16,
        device_map="auto",
        trust_remote_code=True,
    )

prompt = "Vous produisez le retour d'un outil de détection et de correction d'erreures dans des productions écrites de Français comme langue étrangèere (FLE). Fournissez une correction pour l'erreur trouvé par l'outil. Utilisez un langage simple et adapté à des étudiants de français."

sequences = pipe(
    prompt,
    do_sample=True,
    max_new_tokens=100,
    temperature=0.7,
    top_k=50,
    top_p=0.95,
    num_return_sequences=1,
)
print(sequences[0]['generated_text'])

"""# RAG"""

import pandas as pd
import numpy as np